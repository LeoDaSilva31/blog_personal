{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}TU INMOBILIARIA{% endblock %}</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- CSS unificado con cache-busting y namespacing -->
  <link rel="stylesheet" href="{% static 'propiedades/css/theme.css' %}?v=3">

  <link rel="icon" href="{% static 'blog/img/favicon.png' %}" type="image/png"/>

  <!-- Estilos espec√≠ficos del widget de WhatsApp -->
  <style>
    /* Burbuja flotante con movimiento y pulso */
    .wa-float {
      position: fixed;
      right: 18px;
      bottom: 18px;
      width: 58px;
      height: 58px;
      border-radius: 9999px;
      display: grid;
      place-items: center;
      background: radial-gradient(60% 60% at 30% 30%, #67e8f9 0%, #22c55e 40%, #16a34a 100%);
      color: white;
      box-shadow: 0 10px 25px rgba(22, 163, 74, .35), 0 6px 10px rgba(2, 8, 23, .08);
      cursor: pointer;
      z-index: 40;
      transition: transform .2s ease, box-shadow .2s ease;
      animation: wa-bob 4s ease-in-out infinite;
      backdrop-filter: saturate(1.1) blur(6px);
    }
    .wa-float:hover { transform: translateY(-2px) scale(1.03); }
    .wa-float::after {
      content: "";
      position: absolute;
      inset: -8px;
      border-radius: inherit;
      background: radial-gradient(closest-side, rgba(34,197,94,.25), transparent 70%);
      filter: blur(6px);
      opacity: 0;
      animation: wa-pulse 2.6s ease-out infinite;
      pointer-events: none;
    }
    @keyframes wa-bob {
      0%, 100% { transform: translateY(0) }
      50% { transform: translateY(-4px) }
    }
    @keyframes wa-pulse {
      0% { opacity: .25; transform: scale(.95) }
      70% { opacity: 0; transform: scale(1.15) }
      100% { opacity: 0; transform: scale(1.25) }
    }

    /* Panel ‚Äúglass‚Äù que acompa√±a a la burbuja */
    .wa-panel {
      position: fixed;
      right: 18px;
      bottom: 86px; /* encima de la burbuja */
      z-index: 40;
      transform-origin: 100% 100%;
      transition: opacity .18s ease, transform .18s ease;
    }
    .wa-panel.hidden {
      opacity: 0;
      pointer-events: none;
      transform: translateY(6px) scale(.98);
    }
  </style>

  {% block head %}{% endblock %}
</head>
<body class="app-bg text-slate-800 antialiased">

  <!-- Header -->
  <header class="sticky top-0 z-30 backdrop-blur supports-[backdrop-filter]:bg-white/70 bg-white/80 border-b border-slate-200">
    <div class="mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">

      <!-- Logo -->
      <a href="{% url 'propiedades:home' %}" class="flex items-center gap-2 font-semibold text-slate-900">
        <img src="{% static 'blog/img/tu_logo.png' %}" alt="Logo" class="h-8 w-auto" onerror="this.style.display='none'">
        <span>TU INMOBILIARIA</span>
      </a>

      <!-- Nav grande -->
      <nav class="hidden md:flex items-center gap-4 text-sm">
        <a class="hover:underline" href="{% url 'propiedades:home' %}">Inicio</a>
        <a class="hover:underline" href="{% url 'propiedades:lista' %}">Propiedades</a>
        <a class="hover:underline" href="{% url 'propiedades:contacto' %}">Contacto</a>
      </nav>

      <!-- Desktop: bot√≥n buscar -->
      <div class="hidden md:flex items-center gap-2">
        <a href="{% url 'propiedades:busqueda' %}" class="btn btn-secondary text-sm">Buscar</a>
      </div>

      <!-- Mobile: input b√∫squeda + men√∫ -->
      <div class="flex items-center gap-2 md:hidden">
        <form method="get" action="{% url 'propiedades:busqueda' %}" class="relative">
          <input type="text" name="q" placeholder="Buscar..."
                 class="pl-3 pr-8 py-1 rounded border border-slate-300 focus:outline-none focus:ring-2 focus:ring-blue-400 text-sm">
          <button type="submit" class="absolute right-2 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600" aria-label="Buscar">
            üîç
          </button>
        </form>

        <!-- Bot√≥n men√∫ -->
        <button id="menu-toggle" class="p-2 rounded hover:bg-slate-100 focus:outline-none" aria-label="Abrir men√∫">
          ‚ò∞
        </button>
      </div>
    </div>

    <!-- Men√∫ m√≥vil desplegable -->
    <div id="mobile-menu" class="hidden md:hidden px-4 pb-4 space-y-2">
      <a class="block hover:underline" href="{% url 'propiedades:home' %}">Inicio</a>
      <a class="block hover:underline" href="{% url 'propiedades:lista' %}">Propiedades</a>
      <a class="block hover:underline" href="{% url 'propiedades:busqueda' %}">B√∫squeda avanzada</a>
    </div>
  </header>

  <!-- Main -->
  <main class="mx-auto w-full max-w-7xl flex-grow px-4 sm:px-6 lg:px-8 py-8">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="mt-8 border-t border-slate-200">
    <div class="mx-auto w-full max-w-7xl px-4 sm:px-6 lg:px-8 py-6 text-sm text-slate-500 flex flex-col sm:flex-row items-center justify-between gap-2">
      <p>¬© {{ now|date:"Y" }} TU INMOBILIARIA. Todos los derechos reservados.</p>
      <div class="flex items-center gap-4">
        <a class="hover:underline" href="#">T√©rminos</a>
        <a class="hover:underline" href="#">Privacidad</a>
      </div>
    </div>
  </footer>

  {% block scripts %}{% endblock %}

  <!-- Widget WhatsApp -->
  <div id="wa-widget" class="z-40">
    <!-- Panel -->
    <div id="wa-panel" class="wa-panel hidden">
      <div class="rounded-2xl border border-slate-200 bg-white/90 backdrop-blur-md shadow-xl p-3 w-[280px]">
        <div class="flex items-start gap-3">
          <!-- Avatar WA -->
          <div class="shrink-0 grid place-items-center rounded-full bg-emerald-100 text-emerald-700 w-9 h-9">
            <!-- √≠cono simple -->
            <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor" aria-hidden="true">
              <path d="M20.52 3.48A11.94 11.94 0 0 0 12.05 0C5.46 0 .09 5.37.09 12c0 2.11.55 4.18 1.6 6.01L0 24l6.16-1.6A12 12 0 1 0 20.52 3.48Zm-8.47 18.2a9.9 9.9 0 0 1-5.05-1.38l-.36-.21-3.66.95.98-3.57-.23-.37a9.94 9.94 0 1 1 8.32 4.58Zm5.66-7.45c-.31-.16-1.84-.9-2.12-1-.28-.1-.48-.16-.68.16-.2.31-.78 1-.96 1.2-.18.2-.36.23-.67.08-.31-.16-1.31-.48-2.5-1.52-.92-.81-1.54-1.8-1.72-2.11-.18-.31-.02-.48.13-.64.13-.13.31-.34.46-.52.15-.18.2-.31.3-.52.1-.2.05-.39-.03-.55-.08-.16-.68-1.64-.93-2.24-.25-.6-.5-.52-.68-.53-.18 0-.39 0-.6 0-.2 0-.55.08-.84.39-.29.31-1.1 1.08-1.1 2.63 0 1.54 1.12 3.03 1.27 3.23.16.2 2.2 3.35 5.33 4.7.75.32 1.33.51 1.78.65.75.24 1.43.21 1.97.13.6-.09 1.84-.75 2.1-1.47.26-.72.26-1.35.18-1.47-.08-.12-.28-.2-.58-.35Z"/>
            </svg>
          </div>
          <div class="text-sm">
            <p class="font-semibold text-slate-900">¬øNecesit√°s ayuda?</p>
            <p class="text-slate-600">Escribinos por WhatsApp y te respondemos a la brevedad.</p>
            <div class="mt-2 flex gap-2">
              <a id="wa-link" href="#" target="_blank" rel="noreferrer"
                 class="inline-flex items-center gap-2 rounded-lg bg-emerald-600 text-white px-3 py-1.5 text-xs font-semibold hover:brightness-105">
                Abrir WhatsApp
              </a>
              <button id="wa-close" type="button"
                      class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs text-slate-700 hover:bg-slate-50">
                Cerrar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Burbuja -->
    <button id="wa-bubble" type="button" class="wa-float" aria-label="Chatear por WhatsApp" data-phone="5491123456789">
      <!-- √çcono WA blanco -->
      <svg viewBox="0 0 24 24" width="26" height="26" fill="currentColor" aria-hidden="true">
        <path d="M20.52 3.48A11.94 11.94 0 0 0 12.05 0C5.46 0 .09 5.37.09 12c0 2.11.55 4.18 1.6 6.01L0 24l6.16-1.6A12 12 0 1 0 20.52 3.48Zm-8.47 18.2a9.9 9.9 0 0 1-5.05-1.38l-.36-.21-3.66.95.98-3.57-.23-.37a9.94 9.94 0 1 1 8.32 4.58Zm5.66-7.45c-.31-.16-1.84-.9-2.12-1-.28-.1-.48-.16-.68.16-.2.31-.78 1-.96 1.2-.18.2-.36.23-.67.08-.31-.16-1.31-.48-2.5-1.52-.92-.81-1.54-1.8-1.72-2.11-.18-.31-.02-.48.13-.64.13-.13.31-.34.46-.52.15-.18.2-.31.3-.52.1-.2.05-.39-.03-.55-.08-.16-.68-1.64-.93-2.24-.25-.6-.5-.52-.68-.53-.18 0-.39 0-.6 0-.2 0-.55.08-.84.39-.29.31-1.1 1.08-1.1 2.63 0 1.54 1.12 3.03 1.27 3.23.16.2 2.2 3.35 5.33 4.7.75.32 1.33.51 1.78.65.75.24 1.43.21 1.97.13.6-.09 1.84-.75 2.1-1.47.26-.72.26-1.35.18-1.47-.08-.12-.28-.2-.58-.35Z"/>
      </svg>
    </button>
  </div>

  <!-- Scripts -->
  <script>
    // Men√∫ m√≥vil
    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    if (menuToggle && mobileMenu) {
      menuToggle.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
    }

    // WhatsApp widget
    (function() {
      const bubble = document.getElementById('wa-bubble');
      const panel = document.getElementById('wa-panel');
      const link  = document.getElementById('wa-link');
      const close = document.getElementById('wa-close');

      if (!bubble || !panel) return;

      // Configur√° tu n√∫mero ac√°: data-phone="54911...."
      const phone = bubble.getAttribute('data-phone') || '5491123456789';
      const preset = encodeURIComponent('¬°Hola! Me interesa una propiedad y quer√≠a m√°s informaci√≥n üôÇ');
      const waURL = `https://wa.me/${phone}?text=${preset}`;
      if (link) link.href = waURL;

      // Toggle panel
      const open = () => panel.classList.remove('hidden');
      const hide = () => panel.classList.add('hidden');

      bubble.addEventListener('click', (e) => {
        e.stopPropagation();
        panel.classList.toggle('hidden');
      });
      if (close) close.addEventListener('click', hide);

      // Cerrar al click fuera
      document.addEventListener('click', (e) => {
        if (!e.target.closest('#wa-widget')) hide();
      });

      // Evitar cierre si clickean dentro del panel
      panel.addEventListener('click', (e) => e.stopPropagation());
    })();
  </script>
</body>
</html>
